# 报销信息自动填写系统

这是一个基于Python + Playwright的报销信息自动填写系统，可以根据Excel文件中的配置自动填写网页表单。

## 功能特性

- 支持从Excel文件读取报销信息
- 自动填写网页表单（输入框、下拉框、按钮点击）
- 支持子序列处理逻辑
- 支持多种浏览器（Chromium、Firefox、WebKit）
- 完善的错误处理和重试机制
- 详细的日志记录

## 文件结构

```
├── main.py                    # 基础版本主程序
├── reimbursement_automation.py # 增强版主程序
├── config.py                  # 配置文件
├── requirements.txt           # 项目依赖
├── README.md                  # 项目说明
├── 报销信息.xlsx              # 报销信息Excel文件（需要用户提供）
└── 标题-ID.xlsx              # 标题-ID映射文件（需要用户提供）
```

## 安装依赖

```bash
pip install -r requirements.txt
playwright install
```

## 配置说明

### 1. 报销信息.xlsx 文件格式

该文件包含报销信息数据，格式如下：

| 序号 | 姓名 | 金额 | 支付方式 | 报销类型 | 子序列开始 | 子序列结束 |
|------|------|------|----------|----------|------------|------------|
| 1    | 张三 | 100  | 现金     | 差旅费   | 是         |            |
| 1    | 张三 | 200  | 银行卡   | 餐饮费   |            | 是         |
| 2    | 李四 | 150  | 现金     | 办公费   |            |            |

**特殊说明：**
- 序号：相同序号表示同一条报销记录
- 子序列开始/结束：用于处理复杂的多行报销记录
- 以`$`开头的内容表示按钮点击操作
- 下拉框字段会自动识别并选择对应选项

### 2. 标题-ID.xlsx 文件格式

该文件包含表头标题与网页元素ID的映射关系：

| 标题 | 网页元素ID |
|------|------------|
| 姓名 | name_input |
| 金额 | amount_input |
| 支付方式 | payment_method |
| 报销类型 | expense_type |

## 使用方法

### 基础版本

```python
python main.py
```

### 增强版本

```python
python reimbursement_automation.py
```

## 配置参数

在 `config.py` 中可以调整以下参数：

- `TARGET_URL`: 目标网页URL
- `HEADLESS`: 是否隐藏浏览器窗口
- `BROWSER_TYPE`: 浏览器类型
- `DROPDOWN_FIELDS`: 下拉框字段列表
- `BUTTON_PREFIX`: 按钮操作前缀
- 各种等待时间配置

## 程序流程

1. **数据加载**: 读取Excel文件和标题-ID映射
2. **浏览器启动**: 启动指定类型的浏览器
3. **页面导航**: 导航到目标网页
4. **数据处理**: 按序号分组处理报销记录
5. **表单填写**: 根据Excel内容填写表单
6. **子序列处理**: 处理复杂的多行记录
7. **表单提交**: 验证并提交表单
8. **日志记录**: 记录所有操作过程

## 原子操作函数

1. `get_object_id(title)`: 根据标题获取网页元素ID
2. `click_button(element_id)`: 点击按钮
3. `fill_input(element_id, value)`: 填写输入框
4. `select_dropdown(element_id, value)`: 选择下拉框

## 错误处理

- 自动重试机制（最多3次）
- 详细的错误日志
- 元素等待超时处理
- 表单验证失败处理

## 注意事项

1. 确保Excel文件格式正确
2. 确保网页元素ID映射准确
3. 根据实际网页调整选择器
4. 测试时建议使用非隐藏模式
5. 注意网页加载时间，适当调整等待时间

## 扩展功能

- 支持更多表单元素类型
- 添加数据验证规则
- 支持批量处理
- 添加GUI界面
- 支持更多Excel格式 