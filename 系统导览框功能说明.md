# 系统导览框功能说明

## 功能概述

新增的原子功能 `click_navigation_panel()` 用于处理系统导览框的点击操作，支持多种查找和点击方式，能够自动识别并点击类似以下HTML结构的系统导览框：

```html
<div class="syslink ieSensitive noie" onclick="navToPrj('WF_YB6')" title="点击进入">
    <img src="img/wsyy.jpg" style="border:0">
</div>
```

## 使用方法

### 1. Excel数据格式

在报销信息Excel文件中，使用 `@` 前缀标识系统导览框操作：

| 序号 | 姓名 | 系统导航 | 其他字段... |
|------|------|----------|-------------|
| 1    | 张三 | @WF_YB6  | ...         |
| 1    | 张三 | @WF_YB7  | ...         |
| 2    | 李四 | @WF_YB8  | ...         |

### 2. 标题-ID映射

在标题-ID.xlsx文件中添加对应的映射关系：

| 标题 | 网页元素ID |
|------|------------|
| 系统导航 | nav_panel |

## 查找和点击策略

系统采用多种策略来查找和点击导览框，按优先级顺序尝试：

### 策略1: 通过ID直接点击
```python
page.click(f"#{element_id}")
```
适用于导览框有明确ID的情况。

### 策略2: 通过onclick属性查找
```python
selector = f"div[onclick*='{value}']"
page.click(selector)
```
查找包含特定onclick属性的div元素，如 `onclick="navToPrj('WF_YB6')"`。

### 策略3: 通过title属性查找
```python
selector = f"div[title*='{value}']"
page.click(selector)
```
查找包含特定title属性的div元素。

### 策略4: 通过class和文本内容查找
```python
selector = f"div.syslink:has-text('{value}')"
page.click(selector)
```
查找具有特定class的div元素。

### 策略5: 通过JavaScript执行
```python
page.evaluate(f"navToPrj('{value}')")
```
直接执行onclick函数，适用于函数名已知的情况。

## 配置参数

在 `config.py` 中可以配置：

```python
# 系统导览框操作的前缀标识
NAVIGATION_PREFIX = "@"
```

## 错误处理

- 自动重试机制（最多3次）
- 详细的错误日志记录
- 多种查找策略的容错处理
- 超时处理（2秒超时）

## 使用示例

### 示例1: 基本使用
```python
# Excel中填写: @WF_YB6
# 程序会自动查找并点击对应的导览框
```

### 示例2: 在子序列中使用
```python
# 在子序列处理中，导览框操作会按照从左到右的顺序执行
# 序号1的第一行: @WF_YB6
# 序号1的第二行: @WF_YB7
# 序号1的第三行: @WF_YB8
```

### 示例3: 与其他操作组合
```python
# 可以与其他操作组合使用
# 姓名: 张三
# 系统导航: @WF_YB6
# 提交按钮: $submit
```

## 日志输出

程序会输出详细的日志信息：

```
2025-08-05 10:30:15,123 - INFO - 成功点击导览框 (通过onclick): WF_YB6
2025-08-05 10:30:15,456 - INFO - 成功执行导览框JavaScript: WF_YB7
2025-08-05 10:30:15,789 - WARNING - 无法找到或点击导览框: nav_panel, 值: WF_YB8
```

## 注意事项

1. **标识符匹配**: 确保Excel中的标识符与HTML中的onclick参数完全匹配
2. **页面加载**: 确保导览框元素在页面加载完成后存在
3. **权限问题**: 某些系统可能需要登录权限才能访问导览框
4. **JavaScript执行**: 如果直接执行JavaScript，需要确保函数名正确

## 扩展功能

可以根据实际需求扩展查找策略：

```python
# 添加新的查找策略
def custom_navigation_selector(self, page, value):
    # 自定义查找逻辑
    pass
```

## 测试建议

1. 先测试单个导览框操作
2. 再测试在子序列中的导览框操作
3. 验证页面跳转是否正确
4. 检查错误处理是否有效 